$(function(){let t;$("#storage-id").focus(),$(".group").hide(),$("#__partner-id").blur(function(){$("#items").prop("disabled",!1),partners[$("#partner-id").val()]||$("#sale").prop("checked",!1).change()}),$("#sale").change(function(){this.checked?($("table thead tr").removeClass("in").addClass("out"),$(this).parent().parent().parent().addClass("out").removeClass("in"),$(this).parent().find("span").text(StockTexts.hu.sale),$("td:nth-child(2), th:nth-child(2)").show(),$("td:nth-child(4), th:nth-child(4)").show(),$("td:nth-child(5), th:nth-child(5)").show(),$(".group").hide()):($("table thead tr").removeClass("out").addClass("in"),$(this).parent().parent().parent().addClass("in").removeClass("out"),$(this).parent().find("span").text(StockTexts.hu.purchase),$("td:nth-child(2), th:nth-child(2)").hide(),$("td:nth-child(4), th:nth-child(4)").hide(),$("td:nth-child(5), th:nth-child(5)").hide(),$(".group").show())}),$("form").submit(function(){e()&&$("table tbody tr:last").remove()});let e=function(){return!$("table tbody tr:last").find("input[type=hidden]").val()};$(document).on("focus","input.quantity",function(){t=$(this).parent().parent().prev().prev().find("input[type=hidden]").val();let e=products[t][4],n=products[t][5];$(this).parent().parent().next().html(number_format(e)+" / "+number_format(n)),$(this).parent().parent().next().next().html(number_format(n*(1+partners[$("#partner-id").val()]/100))),!$(this).parent().parent().next().next().next().find("input").val()>0&&$(this).parent().parent().next().next().next().find("input").val(number_format(n*(1+partners[$("#partner-id").val()]/100))),$(this).parent().parent().next().next().next().next().next().text(products[t][3]+" %")}),$(document).on("blur","input.net.price",function(){let e=str2Num($(this).val()),n=str2Num($(this).closest("tr").find("input.quantity").val())*e;$(this).parent().parent().next().text(number_format(n));let r=n*(products[t][3]/100);$(this).parent().parent().next().next().next().text(number_format(r)),$(this).parent().parent().next().next().next().next().text(number_format(n+r)),$(this).parent().parent().parent().find(".group input.price").each(function(){$(this).val(number_format(e*($(this).data("percentage")/100+1)))})}),$("#addNewRow").click(function(){let t=$(this).parents("table").find("tbody");if($("tfoot tr").children().each(function(t,e){let n=0;6!=t&&8!=t&&9!=t||($(e).closest("table").find("tbody tr td:nth-child("+(t+1)+")").each(function(t,e){n+=str2Num($(e).text())}),$(e).text(number_format(n)))}),e())$("table tbody tr:last").remove();else{let e=t.children("tr:first"),n=t.children("tr").length;e=e.prop("outerHTML").replace(/items\-0/g,"items-"+n).replace(/items\[0\]/g,"items["+n+"]").replace(/ value="[!"]*"/,' value=""').replace(/td class="text-right">[0-9\.,\/ %]*?<\/td/g,'td class="text-right"></td'),t.append(e)}t.find("datalist:last").prev().focus()})});